#include <stdio.h>
//#include "TXLib.h"
#include <iso646.h>
#include <stdbool.h>
#include <math.h>
#include <assert.h>

void enter_coefficients_manually(double * x1, double * x2);
void solve_quadratic_equation(double a, double b, double c, double * x1, double * x2);
void solve_linear_equation(double b, double c, double * x1, double * x2);
void solve_quadratic_equasion_without_b_coeff(double a, double c, double * x1, double * x2);
void result_output(double x1, double x2);

int main(void)
{
    int working_mode = 3; // 1 - standart input for coeffs, 2 - file input
    int status = 0; //varieble shows the result of scanf, 1 == success
    // -INFINITY == no solutions
    //  INFINITY == inf solutions
    double x1 = -INFINITY;
    double x2 = -INFINITY;

    printf("%lf %lf %d\n", x1, x2, x1 == INFINITY);

    printf("Hello, stranger! Do you wanna solve a quadratic "
           "equation?\nNevertheless, Poltorashka said we gonna do it.\n\n"
           "So, I wanna you to enter three coefficients: a, b and c respectively\n"
           "Or you can choose an input from the file (in developing)\n\n"
           "Enter 1, if you wanna enter coefficients by yourself\n"
           "or 2, if you wanna chose the input from the file: ");

    while ((status = scanf("%d", &working_mode)) != 1 or (working_mode < 1 or working_mode > 2)) //Entering the working mode with errors processing
    {
        if (status != 1)
        {
            while (getchar() != '\n')
            {
                continue;
            }
        }
        printf("Please, enter an integer number, 1 or 2: ");
    }
    
    if (working_mode == 1)
    {
        enter_coefficients_manually(&x1, &x2);
    }

    return 0;
}

void enter_coefficients_manually(double * x1, double * x2)
{
    double a = 0.0;
    double b = 0.0;
    double c = 0.0;
    bool out_check = false; //checks if a user wants to finish and enters 'q'
    printf("\nOk, let's do it! Just enter coefficients through a space, also write down zeros, 3 numbers in common.\n"
            "If you wanna finish, enter just 'q'\n>");
    while (!out_check) //while user doesn't enter 'q'
    {

        while (scanf("%lf %lf %lf", &a, &b, &c) != 3) //input errors processing
        {
            if (getchar() == 'q') // user wants to finish the programm
            {
                out_check = true;
                break;
            }

            while (getchar() != '\n') //buffer cleaning
            {
                continue;
            }
            printf("Enter 3 numbers, like that: \"1 2 3\", or enter 'q' to finish\n>");
        }

        if (out_check) //user entered 'q'
        {
            break;
        }

        printf("check result: a = %lf, b = %lf, c = %lf.\n", a, b, c);
        solve_quadratic_equation(a, b, c, x1, x2);
        result_output(*x1, *x2);

    }
    printf("It was nice to see you here! Come back!\n");
}

void solve_quadratic_equation(double a, double b, double c, double * x1, double * x2)
{
    assert(!x1 || !x2);
    
    if (a == 0.0)
    {
        solve_linear_equation(b, c, x1, x2);
    }
    else{
        if (b == 0.0)
        {
            solve_quadratic_equasion_without_b_coeff(a, c, x1, x2);
        }
        else
        {
            if (c == 0)                                                                   //ax^2 + bx = 0
            {
                double sol1 = 0.0;
                double sol2 = (-b)/(a);
                if (sol1 > sol2)
                {
                    *x1 = sol2;
                    *x2 = sol1;
                }
                else
                {
                    *x1 = sol1;
                    *x2 = sol2;
                }
            }
            else                                                                         //ax^2 + bx + c = o
            {
                double dicriminant = (b*b) - 4*(a)*(c);
                if (dicriminant < 0)
                {
                    *x1 = -INFINITY;
                    *x2 = -INFINITY;
                }
                if (dicriminant == 0.0)
                {
                    *x1 = (-b)/(2*(a));
                    *x2 = -INFINITY;
                }
                if (dicriminant > 0)
                {
                    *x1 = ((-b) - pow(dicriminant, 0.5))/(2*(a));
                    *x2 = ((-b) + pow(dicriminant, 0.5))/(2*(a));
                }
            }
        }
    }
}

void solve_linear_equation(double b, double c, double * x1, double * x2)
{
    assert(!x1 || !x2);
    
    if (b == 0.0)
    {
        if (c == 0.0)                                                                      //0=0
        {
            *x1 = INFINITY;
            *x2 = INFINITY;
        }
        else                                                                               //0=c
        {
            *x1 = -INFINITY;
            *x2 = -INFINITY;
        }
    }
    else
    {
        if (c == 0)                                                                        //bx = 0
        {
            *x1 = 0.0;
            *x2 = -INFINITY;
        }
        else                                                                               //bx + c = 0
        {
            *x1 = (-c)/(b);
            *x2 = -INFINITY;
        }
    }
}

void solve_quadratic_equasion_without_b_coeff(double a, double c, double * x1, double * x2)
{                       
    assert(!x1 || !x2);
    
    if (c == 0.0)                                                                          //ax^2 = 0
    {
        *x1 = 0.0;
        *x2 = -INFINITY;
    }

    else                                                                                   //ax^2 + c = 0
    {
        double eq = (-c)/(a);
        if (eq > 0)
        {
            *x1 = -pow(eq, 0.5);
            *x2 =  pow(eq, 0.5);
        }
        else
        {
            *x1 = -INFINITY;
            *x2 = -INFINITY;
        }
    }
}

void result_output(double x1, double x2)
{
    if ((x1 == -INFINITY) and (x2 == -INFINITY))
    {
        printf("The equasion has no any solutions\n\n>");
    }
    if ((x1 != -INFINITY) and (x2 == -INFINITY))
    {
        printf("The equasion has 1 solution. x = %lf\n\n>", x1);
    }
    if ((x1 != -INFINITY) and (x1 != INFINITY) and (x2 != -INFINITY) and (x2 != INFINITY))
    {
        printf("The equasion has 2 solutions. x1 = %lf, x2 = %lf\n\n>", x1, x2);
    }
    if ((x1 == INFINITY) and (x2 == INFINITY))
    {
        printf("The equasion has an infinity of silutions");
    }

}

//k&r codestyle


/*
early return pattern.
  f():
    if
    if
    if

    ....
*/
